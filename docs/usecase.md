# 📄 Use Case Document: 1인 사업가 멘탈 케어 일기 서비스

---

## 🎭 Actor Definitions (행위자 정의)

| 행위자 | 설명 |
|--------|------|
| 비회원 사용자 | 로그인 없이 서비스 이용 가능. 일기 작성 및 감정 선택, 일부 기능 제한 |
| 회원 사용자 | 로그인 후 전체 기능 사용 가능. 감정 통계, 캘린더, 피드백 기능 활성화 |
| 시스템 | 감정 키워드 추출, 반복 감정 감지, 감정 캘린더 시각화 등 자동 처리 수행 |
| 관리자 | 감정 키워드 사전 관리, 알림 메시지 템플릿 수정 (백오피스에서 별도) |

---

## 📘 Use Case Scenarios (사용자 시나리오 개요)

### UC-01. 감정 일기 작성
- 사용자가 감정 유형을 선택하고 일기를 작성
- 감정 키워드 3개 자동 추출
- 마지막 한 줄 메시지를 입력하여 저장

### UC-02. 감정 캘린더 확인
- 감정 기록을 월별로 확인
- 키워드에 따라 색상으로 시각화

### UC-03. 감정 반복 감지 및 피드백
- 특정 키워드 반복 발생 시 시스템이 자동 감지
- 사용자에게 감정 상태 피드백 제공

### UC-04. 감정 통계 확인
- 주간/월간 감정 키워드 빈도 확인
- 차트로 시각화된 통계 열람

---

## 🔁 Main Steps and Flow of Events

### UC-01. 감정 일기 작성

1. 사용자 `/write` 진입
2. 감정 키워드 선택 (최소 1개 이상)
3. 자유롭게 일기 내용 입력
4. 마지막 한 줄 다짐 메시지 입력
5. 저장 버튼 클릭
6. 시스템:
   - NLP 분석으로 핵심 감정 키워드 3개 추출
   - 감정 및 일기 데이터를 DB or LocalStorage에 저장
   - `/calendar` 및 `/stats`에 연동

---

## 🔄 Alternative Flows and Edge Cases

| 상황 | 대안 처리 |
|------|------------|
| 감정 키워드 선택 없이 저장 시도 | 저장 비활성화, "감정을 선택해주세요" 안내 |
| 인터넷 연결 중단 | LocalStorage에 저장 후, 온라인 시 동기화 |
| 동일한 감정 반복 감지 | “최근 '불안'이 자주 나타나고 있어요. 괜찮으신가요?” 메시지 출력 |
| 감정 키워드 추출 실패 (NLP 오류) | “오늘의 감정을 분석할 수 없어요. 직접 선택해보세요” 대체 플로우 제공 |

---

## 🔒 Preconditions and Postconditions

| 구분 | 내용 |
|------|------|
| 사전 조건 | 사용자는 감정 일기를 작성할 수 있어야 함 (비회원 포함) |
| 사후 조건 | 감정 기록이 저장되고, 캘린더 및 통계 페이지에서 반영됨 |

---

## 📌 Business Rules and Constraints

- 감정 키워드는 하루 1회만 저장 가능 (덮어쓰기 가능)
- 한 줄 메시지는 50자 이하 제한
- 감정 키워드는 내부 컬러 매핑 규칙 고정 (사용자 수정 불가)
- 반복 감정 감지는 3회 이상 동일 키워드 등장 시 발동
- 감정 키워드는 최대 5개 선택 가능

---

## ❗ Exception Handling Procedures

| 에러 상황 | 처리 방식 |
|------------|------------|
| 서버 저장 실패 | 사용자에게 "저장에 실패했어요. 인터넷 연결을 확인해주세요" 메시지 표시 |
| NLP API 실패 | fallback: 전체 텍스트를 사용자에게 보여주며 키워드 수동 선택 유도 |
| 캘린더 로딩 실패 | “감정 캘린더를 불러올 수 없습니다. 다시 시도해주세요” 안내 |

---

## 🧩 User Interface Considerations

- 감정 선택: 고대비 버튼, 시각적 감정 이모지 아이콘 포함
- 일기 작성: placeholder 예시 문장 제공, 자동 저장 지원
- 캘린더: 감정 키워드 컬러는 접근성 고려 (색약 대응)
- 통계 차트: 간결한 뷰와 함께 감정 레이블 텍스트 노출
- 반응형: 모바일에서는 풀스크린 모달 방식으로 감정 작성 UI 제공

---

## 📊 Data Requirements and Data Flow

### 입력 데이터
- 감정 키워드 (선택)
- 일기 본문 (텍스트)
- 한 줄 메시지 (텍스트)

### 출력 데이터
- NLP 추출 키워드
- 감정 피드백 문장
- 감정 키워드별 통계/그래프
- 감정 캘린더 뷰

### 데이터 흐름

```mermaid
graph TD
사용자 -->|입력| UI컴포넌트
UI컴포넌트 -->|전송| Supabase DB
Supabase DB -->|Trigger| NLP 감정 분석 함수
NLP 감정 분석 -->|결과| DB 저장
DB --> 캘린더, 통계, 피드백 컴포넌트